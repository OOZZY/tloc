macro(prepend listVar prefix)
   set(${listVar} "")
   foreach(item ${ARGN})
      list(APPEND ${listVar} ${prefix}${item})
   endforeach(item)
endmacro(prepend)

if ("${CMAKE_C_COMPILER_ID}" STREQUAL "GNU" OR
    "${CMAKE_C_COMPILER_ID}" STREQUAL "Clang")
  if (TLOC_USE_ASAN)
    set(sanitizer_compile_options -fsanitize=address -fsanitize=undefined -O1 -fno-omit-frame-pointer -fno-optimize-sibling-calls)
    set(sanitizer_link_options -fsanitize=address)
  elseif(TLOC_USE_MSAN)
    set(sanitizer_compile_options -fsanitize=memory -fsanitize=undefined -O1 -fno-omit-frame-pointer -fno-optimize-sibling-calls)
    set(sanitizer_link_options -fsanitize=memory)
  endif()
endif()

set(tloc_headers util.h darray.h sllist.h test.h)
set(tloc_sources util.c darray.c sllist.c test.c)
prepend(tloc_headers ${PROJECT_SOURCE_DIR}/include/tlo/ ${tloc_headers})
add_library(tloc STATIC ${tloc_headers} ${tloc_sources})
set_target_properties(tloc PROPERTIES C_EXTENSIONS OFF)
target_compile_features(tloc PUBLIC c_std_11)
target_compile_options(tloc PRIVATE ${warning_compile_options} PUBLIC ${sanitizer_compile_options})
target_include_directories(tloc PUBLIC ${PROJECT_SOURCE_DIR}/include)
target_link_libraries(tloc PUBLIC ${sanitizer_link_options})
